# Домашнее задание к занятию "`Резервное копирование`" - `Иванов Сергей`


### Инструкция по выполнению домашнего задания

   1. Сделайте `fork` данного репозитория к себе в Github и переименуйте его по названию или номеру занятия, например, https://github.com/имя-вашего-репозитория/git-hw или  https://github.com/имя-вашего-репозитория/7-1-ansible-hw).
   2. Выполните клонирование данного репозитория к себе на ПК с помощью команды `git clone`.
   3. Выполните домашнее задание и заполните у себя локально этот файл README.md:
      - впишите вверху название занятия и вашу фамилию и имя
      - в каждом задании добавьте решение в требуемом виде (текст/код/скриншоты/ссылка)
      - для корректного добавления скриншотов воспользуйтесь [инструкцией "Как вставить скриншот в шаблон с решением](https://github.com/netology-code/sys-pattern-homework/blob/main/screen-instruction.md)
      - при оформлении используйте возможности языка разметки md (коротко об этом можно посмотреть в [инструкции  по MarkDown](https://github.com/netology-code/sys-pattern-homework/blob/main/md-instruction.md))
   4. После завершения работы над домашним заданием сделайте коммит (`git commit -m "comment"`) и отправьте его на Github (`git push origin`);
   5. Для проверки домашнего задания преподавателем в личном кабинете прикрепите и отправьте ссылку на решение в виде md-файла в вашем Github.
   6. Любые вопросы по выполнению заданий спрашивайте в чате учебной группы и/или в разделе “Вопросы по заданию” в личном кабинете.
   
Желаем успехов в выполнении домашнего задания!
   
### Дополнительные материалы, которые могут быть полезны для выполнения задания

1. [Руководство по оформлению Markdown файлов](https://gist.github.com/Jekins/2bf2d0638163f1294637#Code)

---

## Задание 1
* Составьте команду rsync, которая позволяет создавать зеркальную копию домашней директории пользователя в директорию /tmp/backup
* Необходимо исключить из синхронизации все директории, начинающиеся с точки (скрытые)
* Необходимо сделать так, чтобы rsync подсчитывал хэш-суммы для всех файлов, даже если их время модификации и размер идентичны в источнике и приемнике.
* На проверку направить скриншот с командой и результатом ее выполнения

## Решение

Создаем тестовую директорию куда будем синхронизировать файлы.
``` bash
mkdir -p /tmp/backup
```

Синхронизируем домашнюю директорию с папкой /tmp/backup/:
``` bash
rsync -avc --delete --exclude='*/.*' --exclude='.*/' ~ /tmp/backup
```
Результат выполнения команды:

![""](https://github.com/radiomost/backup/blob/main/img/img21.png)


Содержимое домашней директории:

![""](https://github.com/radiomost/backup/blob/main/img/img22.png)

Содержимое синхронизированной директории:

![""](https://github.com/radiomost/backup/blob/main/img/img23.png)

Удалим директорию синхронизации:

``` bash
rm -rf /tmp/backup/
```

`--exclude='.*/'` — исключает скрытые директории в корне и подкаталогах.

`--exclude='*/.*'` — исключает скрытые поддиректории на любом уровне.

`-c` — rsync сравнивает файлы по хэш-сумме.

`--delete` — удаляет файлы на приёмной стороне, которых нет в источнике.

`.` — текущая домашняя директория пользователя.

`/tmp/backup` — каталог-назначение.
### Задание выполнено.
---

## Задание 2
* Написать скрипт и настроить задачу на регулярное резервное копирование домашней директории пользователя с помощью rsync и cron.
* Резервная копия должна быть полностью зеркальной
* Резервная копия должна создаваться раз в день, в системном логе должна появляться запись об успешном или неуспешном выполнении операции
* Резервная копия размещается локально, в директории /tmp/backup
* На проверку направить файл crontab и скриншот с результатом работы утилиты.

## Решение
Скрипт представлен в корне репозитория `backup.sh` (перейдите по ссылке)
[backup.sh](https://github.com/radiomost/backup/blob/main/backup.sh)

Результаты работы утилиты:
Содержимое домашней директории

![""](https://github.com/radiomost/backup/blob/main/img/img24.png)

Содержимое папки /tmp/backup

![""](https://github.com/radiomost/backup/blob/main/img/img25.png)

Запись с системном журнале
``` bash
journalctl | grep Backup
```

![""](https://github.com/radiomost/backup/blob/main/img/img26.png)


Запись в cron

``` bash
crontab -e
```

![""](https://github.com/radiomost/backup/blob/main/img/img27.png)

Запуск в 3:00
### Задание выполнено.


## Задания со звёздочкой*

---
Эти задания дополнительные. Их можно не выполнять. На зачёт это не повлияет. Вы можете их выполнить, если хотите глубже разобраться в материале.
---

## Задание 3*
* Настройте ограничение на используемую пропускную способность rsync до 1 Мбит/c
* Проверьте настройку, синхронизируя большой файл между двумя серверами
* На проверку направьте команду и результат ее выполнения в виде скриншота

## Решение
Генерируем файл размером 1M `bigfile.img`
![""](https://github.com/radiomost/backup/blob/main/img/img28.png)

```
rsync -av --bwlimit=128 bigfile.img user@remote-server:/path/to/destination/
```
* '-a' — архивный режим

* '-v' — подробный вывод

* '--bwlimit=128' — ограничение скорости до 128 КБ/с = 1 Мбит/с

* 'bigfile.img' — имя большого файла (можно использовать любой большой файл, например, >100MB)

* 'user@remote-server:/path/to/destination/' — путь назначения на другом сервере

Передаем файл размером 1M `bigfile.img` на сервер dev2
![""](https://github.com/radiomost/backup/blob/main/img/img29.png)

* '--info=progress2'	Показывает общий прогресс передачи

### Задание выполнено.
---

## Задание 4*
* Напишите скрипт, который будет производить инкрементное резервное копирование домашней директории пользователя с помощью rsync на другой сервер
* Скрипт должен удалять старые резервные копии (сохранять только последние 5 штук)
* Напишите скрипт управления резервными копиями, в нем можно выбрать резервную копию и данные восстановятся к состоянию на момент создания данной резервной копии.
* На проверку направьте скрипт и скриншоты, демонстрирующие его работу в различных сценариях.

## Решение
1. Hазработан скрипт `backup_incremental.sh` (перейдите по ссылке)
[backup.sh](https://github.com/radiomost/backup/blob/main/backup.sh)

### Этот скрипт будет:
* Создавать инкрементные бэкапы (через --link-dest)
* Сохранять их в папках с датой
* Хранить только последние 5 копий
* Отправлять бэкапы на удалённый сервер через ssh

Запускаем скрипт на сервере dev1
![""](https://github.com/radiomost/backup/blob/main/img/img30.png)

Результат выполнения скрипта наблюдаем на сервере dev2 видим что в корне репозитория 'backup' присутствует папка бэкапа и символическая ссылка на последний бэкап папки.
![""](https://github.com/radiomost/backup/blob/main/img/img31.png)

Содержимое последней папки бэкапа
![""](https://github.com/radiomost/backup/blob/main/img/img32.png)

Содержимое файла 'testfile.txt' из последней папки бэкапа
![""](https://github.com/radiomost/backup/blob/main/img/img33.png)

Изменяем файл 'testfile.txt' на машине dev1 с кастомным содержание 'Testovoe soderjanie
![""](https://github.com/radiomost/backup/blob/main/img/img34.png)

Запускаем скрипт восстаноления на машине dev1
![""](https://github.com/radiomost/backup/blob/main/img/img35.png)

Видим что содержимое файла 'testfile.txt' восстановилось из бэкапа '2025-08-02_20-21-19'

### Задание выполнено.
---

### Правила приема работы
1. Необходимо следовать инструкции по выполнению домашнего задания, используя для оформления репозиторий Github
2. В ответе необходимо прикладывать требуемые материалы - скриншоты, конфигурационные файлы, скрипты. Необходимые материалы для получения зачета указаны в каждом задании.

---

### Критерии оценки
* Зачет - выполнены все задания, ответы даны в развернутой форме, приложены требуемые скриншоты, конфигурационные файлы, скрипты. В выполненных заданиях нет противоречий и нарушения логики
* На доработку - задание выполнено частично или не выполнено, в логике выполнения заданий есть противоречия, существенные недостатки, приложены не все требуемые материалы.
